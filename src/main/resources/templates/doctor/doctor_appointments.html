<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Doctor Appointments Dashboard</title>
    <style>
        .doctor_appoinment-content {
            margin-left: 250px;
            margin-top: 60px;
            padding: 20px;
            min-height: calc(100vh - 60px);
            background-color: #ecf0f1;
        }

        .doctor_appoinment-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .doctor_appoinment-table th, .doctor_appoinment-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        .doctor_appoinment-table th {
            background-color: #333;
            color: white;
        }

        .doctor_appoinment-table tr:nth-child(even) {
            background-color: #f2f2f2;
        }

        .doctor_appoinment-table tr:hover {
            background-color: #ddd;
        }

        .doctor_appoinment-action-btn {
            border: none;
            padding: 5px 10px;
            margin-right: 5px;
            cursor: pointer;
        }

        .doctor_appoinment-view {
            background-color: #007bff;
            color: white;
        }

        .doctor_appoinment-confirm {
            background-color: #28a745;
            color: white;
        }

        .doctor_appoinment-reject {
            background-color: #dc3545;
            color: white;
        }
    </style>
</head>
<body>
<div class="doctor_appoinment-content">
    <h2>Danh sách bệnh nhân hôm nay</h2>
    <p>Quản lý, chỉ số, cập nhật trạng thái khám</p>
    <table class="doctor_appoinment-table" id="appointmentsTable">
        <thead>
        <tr>
            <th>ID</th>
            <th>Ngày & Giờ</th>
            <th>Tên Bệnh Nhân</th>
            <th>Trạng Thái</th>
            <th>Nhân viên điều phối</th>
            <th>Thao Tác</th>
        </tr>
        </thead>
        <tbody id="appointmentsTableBody">
        <!-- Data will be populated by JS -->
        </tbody>
    </table>
    <div id="confirmationModal" style="display:none; position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.5); z-index:1000;">
        <div style="background:white; width:400px; margin:100px auto; padding:20px; border-radius:8px; text-align:center;">
            <h3>Hồ sơ đã được xác nhận thành công!</h3>
            <p>Bác sĩ có thể bắt đầu khám bệnh ngay bây giờ.</p>
            <button id="startExaminationBtn" style="margin-top:10px;">Bắt đầu khám bệnh</button>
            <br/>
            <button onclick="closeConfirmationModal()" style="margin-top:10px;">Đóng</button>
        </div>
    </div>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const doctor_id = 1; // Giả sử doctorId cố định lúc này

            fetch(`/appointments/${doctor_id}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error("Network response was not ok");
                    }
                    return response.json();
                })
                .then(data => {
                    const tableBody = document.getElementById("appointmentsTableBody");
                    tableBody.innerHTML = ""; // clear any existing rows

                    data.forEach(appointment => {
                        const row = document.createElement("tr");


                        // Tạo nội dung row bằng cách template literal
                        row.innerHTML = `
                        <td>${appointment.id}</td>
                        <td>null</td> <!-- Nếu có dữ liệu cần thay null -->
                        <td>${appointment.patientName}</td>
                        <td>${appointment.status}</td>
                        <td>${appointment.coordinatorName}</td>
                        <td>
                            <button class="doctor_appoinment-action-btn doctor_appoinment-confirm" type="button">Xác nhận</button>
                            <button class="doctor_appoinment-action-btn doctor_appoinment-reject" type="button">Từ chối</button>
                        </td>
                    `;

                        // Gán sự kiện click cho từng button sau khi tạo row
                        const [btnConfirm, btnReject] = row.querySelectorAll("button");
                        btnConfirm.onclick = () => confirmAppointment(appointment.id);
                        btnReject.onclick = () => rejectAppointment(appointment.id);

                        tableBody.appendChild(row);
                    });
                })
                .catch(error => {
                    console.error("Error fetching appointments:", error);
                });
        });

        function confirmAppointment(id) {
            // if (confirm('Xác nhận hồ sơ cho bệnh nhân với ID: ' + id + '?')) {
            //     // Giả sử bạn muốn gọi API xác nhận ở đây
            //     fetch(`/appointments/confirm/${id}`, {
            //         method: 'POST'
            //     })
            //         .then(response => {
            //             if (!response.ok) {
            //                 throw new Error("Xác nhận thất bại");
            //             }
            //             return response.json(); // nếu API trả về JSON
            //         })
            //         .then(data => {
            //             // Hiển thị modal
            //             showConfirmationModal(id);
            //         })
            //         .catch(error => {
            //             alert('Xác nhận thất bại: ' + error.message);
            //         });
            // }
            showConfirmationModal(id);
        }

        function showConfirmationModal(id) {
            const modal = document.getElementById('confirmationModal');
            modal.style.display = 'block';
            document.getElementById('startExaminationBtn').onclick = function() {
                startExamination(id);
            };
        }

        function closeConfirmationModal() {
            const modal = document.getElementById('confirmationModal');
            modal.style.display = 'none';
        }

        function startExamination(id) {
            const modal = document.getElementById('confirmationModal');
            modal.style.display = 'none';
            window.location.href = `/doctor/in-progress?appoint_id=${id}`;
        }

        function rejectAppointment(id) {
            if (confirm('Từ chối hồ sơ cho bệnh nhân với ID: ' + id + '?')) {
                alert('Hồ sơ với ID ' + id + ' đã bị từ chối.');
                // Add your rejection logic here
            }
        }
    </script>

</div>
</body>
</html>